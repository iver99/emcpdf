apply plugin: 'TestInfraPlugin'
apply plugin: 'artifactory-publish'
apply plugin: 'maven-publish'
apply plugin: 'java'
apply plugin: 'gavsetting'

buildscript {
    repositories {
        mavenLocal()
        maven {
            url = "${artifactory_contextUrl}/emaas-virtual"
        }
/*        maven {
            url = "${artifactory_contextUrl}/repo"
        }*/
    }

    dependencies {
        classpath group: 'org.jfrog.buildinfo', name: 'build-info-extractor-gradle', version: '2.2.5'
        classpath group: 'com.oracle.emaas.emdi', name: 'GAVPlugin', version: '1.0.0+'
        classpath group:"com.oracle.emaas.emdi", name: "TestInfraPlugin", version: '1.1+', transitive: true
    }
}

artifactory {
    contextUrl = "${artifactory_contextUrl}"
    publish {
        repository {
            repoKey = "${artifactory_repoKey}"
            username = "${artifactory_user}"
            password = "${artifactory_password}"
            maven = true
            }
    }
   /* resolve {
            repository {
                repoKey = "repo"
            }
        }*/
    
}


sourceSets {
        test {
        resources.srcDirs = ["src/test/java"]    
        compileClasspath = configurations.lrgConfig + configurations.webdriver
        }
    }

clean{
  delete 'build'
}
task TestJar(type:Jar) {
from sourceSets.test.output
}

check.dependsOn TestJar

group = 'com.oracle.emaas.emcpdf.Webdriver.uitest'

publishing {
        publications {
                  TestPublish(MavenPublication) {
                setArtifactId(project.name)
                artifact TestJar.archivePath
                pom.withXml { XmlProvider xmlProvider ->
                        def dependencies = asNode().appendNode('dependencies')
                        configurations.lrgConfig.getResolvedConfiguration().getFirstLevelModuleDependencies().each {
                                def dependency = dependencies.appendNode('dependency')
                                dependency.appendNode('groupId', it.moduleGroup)
                                dependency.appendNode('artifactId', it.moduleName)
                                dependency.appendNode('version', it.moduleVersion)
                        }
                }
            }

        }
repositories {
        maven {
            url "${artifactory_contextUrl}/emaas-virtual"
            credentials {
                username = "${artifactory_user}"
                password =  "${artifactory_password}"
            }
        }
      }
    }

artifactoryPublish {
publications ('TestPublish')

    }

