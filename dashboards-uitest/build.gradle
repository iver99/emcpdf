apply plugin: 'TestInfraPlugin'
apply plugin: 'artifactory-publish'
apply plugin: 'maven-publish'
apply plugin: 'java'


sourceSets {
        test {
        resources.srcDirs = ["src/test/java"]    
        compileClasspath = configurations.testConfig + configurations.webdriver + compileClasspath + configurations.testNG
        }
    }

clean{
  delete 'build'
}
task TestJar(type:Jar) {
from sourceSets.test.output
}

check.dependsOn TestJar


project.publishGroup1='com.oracle.emaas.emcpdf.test';
publishing {
        publications {
                  TestPublish(MavenPublication) {
                setArtifactId(project.name)
                artifact TestJar.archivePath
		version project.version
		groupId  project.publishGroup1
                pom.withXml { 
                        def dependencies = asNode().appendNode('dependencies')
                        configurations.testConfig.getResolvedConfiguration().getFirstLevelModuleDependencies().each {
                                def dependency = dependencies.appendNode('dependency')
                                dependency.appendNode('groupId', it.moduleGroup)
                                dependency.appendNode('artifactId', it.moduleName)
                                dependency.appendNode('version', it.moduleVersion)
                        }
                }
            }

        }
repositories {
        maven {
            url "${artifactory_contextUrl}/emaas-virtual"
            credentials {
                username = "${artifactory_user}"
                password =  "${artifactory_password}"
            }
        }
      }
    }

artifactoryPublish {
publications ('TestPublish')

    }

